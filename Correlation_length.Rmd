# Fitting heaviy tails to modis VCF

## Setup

```{r setup, eval=T }
load(".RData")

oldcd <-getwd()


require(pander)
require(plyr)
require(dplyr)

panderOptions('table.split.table',Inf)
panderOptions('table.style', 'multiline')
options("scipen"=6, "digits"=6)

#Load package
library(poweRlaw) 

#source("R/powerlaw/discpowerexp.R")
#source("R/powerlaw/discexp.R")
#source("R/powerlaw/zeta.R")

# Load functions for continuous ht distributions
#
source("R/powerlaw/powerexp.R")
source("R/powerlaw/exp.R")
source("R/powerlaw/pareto.R")

# Functions for the analysis
#
source("R/power_fun.r")

# Set global options and parameters 
#
options.glo <- vector("list", length=0)
options.glo$GOF <- 1						# Estimate godness of fit for power law 
options.glo$ploting <- 0					# Plots of cumulative distributions
options.glo$data_set_name <- ""				# image_names from wich patch sizes were calculated
options.glo$resultsDir <- ""        		# Folder with bin files  
options.glo$sample_data <- 0                # Set  >0 For testing
options.glo$original_bin_files <- ""        # Files with patch sizes for each region (bin=binary)
options.glo$xmins <- seq(1:500)				# Range of xmins (minimun patch sizes) to fit 
											#
											# Size of the maximun xmin in Km 233*233*400/(1000*1000)

```


# Correlation length and Percolation indices for AF

The percolation threshold for Moore Neighborhood (z=8 3N+2N) = 0.407
Malarz, K.; S. Galam (2005). "Square-lattice site percolation at increasing ranges of neighbor bonds". Physical Review E 71 (1): 016125. 

```{r percoAnalysisAF, eval=F,echo=T,message=T,warning=T}

# Set folder with results for the region 
#
options.glo$resultsDir <- "Results/africa"

set.seed(seed=0)

setwd(options.glo$resultsDir)

# Reads a site percolation simulations using maximun convex hull area of forest.
#
rnd_percolation <- read_random_percolation("AF")

# Read the correlation length for the forest patches and years.
#
region_corr <- read_region_correlation("AF")

# Plot of correlation length by region and year
#
ggplot(region_corr,aes(correlation_length_km,year,colour=subregion))+theme_bw() + geom_point(shape=1) + facet_wrap(region ~ subregion,scales="free_x")

setwd(oldcd) # oldcd is a global variable 

# Estimates the exponent of the correlation length power law 
#
# The correlation exponent should be near  1.33333
#
corr_exp <-est_correlation_exponent(c(0.2,0.41),0.407,rnd_percolation)

# Calculates the percolation probability using the estimated correlation exponent, assuming the critical point is known.
#
region_cor <-calc_critical_probability(c(0.2,0.41),0.407,corr_exp, region_corr)

# Plot of the probability of percolation
#
ggplot(region_cor_p,aes(p,correlation_length_km,colour=subregion))+theme_bw() + geom_point(shape=1) + facet_wrap(~region ,scales="free_y")


# Plot the data correlation length with percolation probability colour=subregion
#
ggplot(rnd_percolation,aes(p_set,correlation_length_km))+theme_bw() + geom_point(shape=1) + facet_wrap(region ~ subregion,scales="free_y") + geom_point(aes(p,correlation_length_km,colour=subregion),data=region_cor)

# Estimate the critical point of site percolation using logistic equation
#
crit_point <- est_critical_point(rnd_percolation)

# Calculate the percolation probability using logistic equation parms from est_critical_point
#
region_cor <-calc_critical_probability_logis(crit_point,region_cor)

ggplot(rnd_percolation,aes(p_set,correlation_length_km))+theme_bw() + geom_point(shape=21) + facet_wrap(region ~ subregion,scales="free_y") + geom_point(aes(pl,correlation_length_km,colour=subregion),data=region_cor) +
	 geom_point(aes(p,correlation_length_km,colour=subregion),shape=25,colour="red",data=region_cor)

# Percolation probability and critical points by subregion, estimated using logistic regression
#
ggplot(region_cor,aes(pl,year,colour=subregion))+theme_bw() + geom_point(shape=1) + facet_wrap(~region ,scales="free_y") +
	geom_vline(aes(xintercept = pcrit,colour=subregion),data = crit_point) 

#rm(correlation_length_km,correlation_length_km_set,correlation_sampled_distance_km,p_set,equivalent_diameter_km,
#   maximum_length_km,total_area_km2,extrapolation_min_value_km,fit)	

```

Africa is subcritical, already fragmented

Madagascar is critical, oscilating around the critical point.(Region 2)






