# Generate GIF animations of maximun patch dynamics 

## Setup

```{r setup, eval=T }

oldcd <-getwd()
require(plyr)
require(dplyr)
require(rgdal)
require(raster)
require(rworldmap)
require(dismo)
#require(gdalUtils)
rasterOptions(tmpdir="~/Academicos/tmp")
source("R/map_fun.r")

```

## Generate top 2 patches for africa

```{r AF_Smax, eval=F }

# Set folder with results for the region 
#
options.glo$resultsDir <- "Results/africa"
setwd(options.glo$resultsDir)

# Generate 10 times aggregated raster files with values=subregion
#
aggregate_top_200_patch()

# Get crs to reproject
#
bk<-gmap("Africa")
plot(bk)

# Reproject the aggregated rasters to mercator
#
reproject_top_2(crs(bk))


# Generate a list with the extent of subregions
# Interactive crop of the extent
#
bk<-gmap("DR Congo",ext=3)
plot(bk)
ee <-list(extent(bk))

bk<-gmap("Madagascar")
plot(bk)
de<-drawExtent()
bk <-crop(bk,de)
plot(bk)
ee <-c(ee,extent(bk))

# Save region extent for posterior use
#saveRDS(ee,"extent_na.rds")

# Read regions extent
ee<-readRDS("extent_na.rds")

gif_top_2_patch(ee)

gif_top_2_patch(ee,"g")

setwd(oldcd)

# # Generate a composite with all the regions 
# #
# a_files <-list.files(pattern="^.*Percent_Tree_Cover_Top_2\\.tif$")
# r_1 <- raster(a_files[16])
# crs(r_1)
# crs(bk)
# extent(r_1)
# ee <-extent(bk)
# r_1 <- crop(r_1,extent(bk))
# 
# require(RColorBrewer)
# colvec <- brewer.pal(4,"Dark2")
# plot(bk, legend=FALSE, axes=FALSE, box=FALSE,main="2010")	
# text(10,10,"2010")
# plot(r_1,legend=F,col=colvec,add=T,main="2001")
# country.si <- spTransform(countriesLow, crs(r_1))
# plot(country.si,add=T)
# 
# c.layer <- list("sp.lines", country.si)
# 
# spplot(r_1,at=c(0,1,2),colorkey= list(labels = list( labels = c("1","2"),at=c(0,1,2),height = 0.2))
# 	   	,sp.layout=c.layer, col.regions = colvec[1:2])

```

# Generate maps for Eurasia EUAS

```{r euas_Smax, eval=F }


# Set folder with results for the region 
#
options.glo$resultsDir <- "Results/eurasia"
setwd(options.glo$resultsDir)

# Generate 10 times aggregated raster files with values=subregion
#
aggregate_top_200_patch()

bk<-gmap("Rusia")
reproject_top_2(crs(bk))

# Generate regions for GIFs
#
bk<-gmap("Rusia")
plot(bk)
ee<-drawExtent()
bk<-crop(bk,ee)
plot(bk)
ee <-list(extent(bk))


# Generate a list with the extent of subregions
bk<-gmap("Japan")
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
plot(bk)
ee <-c(ee,extent(bk))

bk<-gmap("United Kingdom")
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
plot(bk)
ee <-c(ee,extent(bk))

#saveRDS(ee,"extent_euas.rds")

ee<-readRDS("extent_euas.rds")


gif_top_2_patch(ee)

gif_top_2_patch(ee,"g")

setwd(oldcd)


#a_files <-list.files(pattern="^EUAS.*\\.tif$")

setwd(oldcd)
```

# Generate maps for Northamerica NA

```{r na_Smax, eval=F }

# Set folder with results for the region 
#
options.glo$resultsDir <- "Results/northamerica"
setwd(options.glo$resultsDir)

# Generate 10 times aggregated raster files with values=subregion
#
aggregate_top_200_patch()

bk<-gmap("North America")
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
ee <-list(extent(bk))

reproject_top_2(crs(bk))

bk<-gmap("Newfoundland")
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
plot(bk)
ee <-c(ee,extent(bk))
#saveRDS(ee,"extent_na.rds")

ee<-readRDS("extent_na.rds")

# subregion 5 need a extent object in position 5 
ee <-c(ee,ee[[2]],ee[[2]],ee[[2]])

gif_top_2_patch(ee,"c")

#gif_top_2_patch(ee,"c",5)

gif_top_2_patch(ee,"g")

# a_files <-list.files(pattern="^.*Percent_Tree_Cover\\.tif_Top_200_forest_patches\\.tif$")
# a_files <-list.files(pattern="^.*Percent_Tree_Cover_Top_2\\.tif$")
# 
# r1 <-raster(a_files[1])
# r1 <-crop(r1,ee[[2]])
# plot(r1)

setwd(oldcd)

```


# Australia Oceania OC 

```{r oc_Smax, eval=F }

# Set folder with results for the region 
#
options.glo$resultsDir <- "Results/oceania"
setwd(options.glo$resultsDir)

# Generate 10 times aggregated raster files with values=subregion
#
aggregate_top_200_patch()

bk<-gmap("Australia")
#plot(bk)

reproject_top_2(crs(bk))

# Recover from crash
# a_f <-list.files(pattern="^.*Percent_Tree_Cover_Top_2\\.tif$")
# 
# a_f <- a_f[58:length(a_f)]
# reproject_top_2(crs(bk),a_f)


# OC 1
bk<-gmap("Australia")
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
ee <-list(extent(bk))

# OC 2
bk<-gmap("Papua New Guinea",exp=2)
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
plot(bk)
ee <-c(ee,extent(bk))

# OC 3
bk<-gmap("Kalimantan",exp=2)
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
plot(bk)
ee <-c(ee,extent(bk))


# OC 4
bk<-gmap("Sumatra",exp=2)
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
plot(bk)
ee <-c(ee,extent(bk))

# OC 5
bk<-gmap("Sulawesi",exp=2)
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
plot(bk)
ee <-c(ee,extent(bk))


# OC 6
bk<-gmap("New Zealand")
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
plot(bk)
ee <-c(ee,extent(bk))

# OC 7
bk<-gmap("Java Indonesia")
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
plot(bk)
ee <-c(ee,extent(bk))

# OC 8 == OC 6 New Zealand
ee <-c(ee,ee[[6]])


#saveRDS(ee,"extent_oc.rds")

ee<-readRDS("extent_oc.rds")

# Generate GIF 
gif_top_2_patch(ee)

gif_top_2_patch(ee,"g")

# a_files <-list.files(pattern="^.*Percent_Tree_Cover\\.tif_Top_200_forest_patches\\.tif$")
# a_files <-list.files(pattern="^.*Percent_Tree_Cover_Top_2\\.tif$")
# 
# r1 <-raster(a_files[106])
# r1 <-crop(r1,ee[[8]])
# plot(r1,col=rainbow(2))

setwd(oldcd)
```

# South america SAST/SAT?

```{r sa_Smax, eval=F }

# Set folder with results for the region 
#
options.glo$resultsDir <- "Results/southamerica"
setwd(options.glo$resultsDir)

# Generate 10 times aggregated raster files with values=subregion
#
aggregate_top_200_patch()

bk<-gmap("South America")
#plot(bk)

reproject_top_2(crs(bk))

# SAST 1
bk<-gmap("South America")
plot(bk)
#de<-drawExtent()
#bk<-crop(bk,de)
ee <-list(extent(bk))

# SAST 2
bk<-gmap("Cuba")
plot(bk)
#de<-drawExtent()
#bk<-crop(bk,de)
#plot(bk)
ee <-c(ee,extent(bk))

# SAT 1
bk<-gmap("South america")
plot(bk)
de<-drawExtent()
bk<-crop(bk,de)
plot(bk)
ee <-c(ee,extent(bk))

#saveRDS(ee,"extent_sa.rds")

#ee<-readRDS("extent_sa.rds")

# Generate GIF 
gif_top_2_patch(ee)

gif_top_2_patch(ee,"g")

setwd(oldcd)
```

# South Asia SEAS

```{r seas_map, eval=T }

# Set folder with results for the region 
#
options.glo$resultsDir <- "Results/southasia"
setwd(options.glo$resultsDir)

# Generate 10 times aggregated raster files with values=subregion
#
aggregate_top_200_patch()

bk<-gmap("China")
plot(bk)

reproject_top_2(crs(bk))

```
